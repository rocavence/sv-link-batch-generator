<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>StreetVoice 街聲 sv.link 批次工具</title>
    <link rel="stylesheet" href="/static/css/style.css">
</head>
<body>
    <header class="header">
        <div class="header-content">
            <div class="logo">StreetVoice 街聲</div>
            <div class="subtitle">sv.link 批次工具</div>
            <div class="current-account" id="currentAccount" style="display: none;">
                <span class="label">當前帳號：</span>
                <span id="currentEmail"></span>
            </div>
        </div>
    </header>

    <div class="container">
        <!-- 選單切換 -->
        <div class="tab-container">
            <button class="tab-btn active" id="generateTab" onclick="switchTab('generate')">
                🔗 批次生成
            </button>
            <button class="tab-btn" id="lookupTab" onclick="switchTab('lookup')">
                📊 批次反查
            </button>
            <button class="tab-btn" id="updateTab" onclick="switchTab('update')">
                📝 批次修改
            </button>
        </div>

        <!-- 批次生成介面 -->
        <div class="tab-content active" id="generateContent">
            <div class="main-card">
                <div class="form-section">
                    <div class="form-group">
                        <label for="apiKey">sv.link API Key</label>
                        <input type="password" id="apiKey" placeholder="請輸入您的 API Key">
                    </div>

                    <div class="form-group">
                        <label for="urlList">要縮短的網址清單（每行一個）</label>
                        <div class="url-input-wrapper">
                            <div class="line-numbers" id="lineNumbers">1</div>
                            <textarea id="urlList" placeholder="https://streetvoice.com/artist1/&#10;https://streetvoice.com/artist2/&#10;https://streetvoice.com/artist3/"></textarea>
                        </div>
                    </div>

                    <button class="btn" id="processBtn">
                        <div class="loading" id="loading"></div>
                        <span id="btnText">開始處理</span>
                    </button>

                    <div class="progress" id="progress">
                        <div class="progress-bar" id="progressBar"></div>
                    </div>

                    <div class="status-message" id="statusMessage"></div>
                </div>

                <div class="results" id="results">
                    <div class="form-section">
                        <h3>處理結果</h3>
                        <div id="resultList"></div>
                    </div>
                </div>

                <div class="export-section" id="exportSection">
                    <h3>匯出選項</h3>
                    <div class="export-buttons">
                        <button class="btn" id="exportCsv">📄 匯出 CSV</button>
                        <button class="btn btn-secondary" id="exportQrZip">🎨 預覽 QR Code</button>
                    </div>
                </div>
            </div>
        </div>

        <!-- 批次反查介面 -->
        <div class="tab-content" id="lookupContent">
            <div class="main-card">
                <div class="form-section">
                    <div class="form-group">
                        <label for="lookupApiKey">sv.link API Key</label>
                        <input type="password" id="lookupApiKey" placeholder="請輸入您的 API Key">
                    </div>

                    <div class="form-group">
                        <label for="linkList">要反查的短網址清單（每行一個）</label>
                        <div class="url-input-wrapper">
                            <div class="line-numbers" id="lookupLineNumbers">1</div>
                            <textarea id="linkList" placeholder="https://sv.link/kDBwcE&#10;https://sv.link/DBHMSG&#10;https://sv.link/cfhn2Q"></textarea>
                        </div>
                    </div>

                    <button class="btn" id="lookupBtn">
                        <div class="loading" id="lookupLoading"></div>
                        <span id="lookupBtnText">開始反查</span>
                    </button>

                    <div class="progress" id="lookupProgress">
                        <div class="progress-bar" id="lookupProgressBar"></div>
                    </div>
                </div>

                <div class="results" id="lookupResults">
                    <div class="form-section">
                        <h3>反查結果</h3>
                        <div id="lookupResultList"></div>
                    </div>
                </div>

                <div class="export-section" id="lookupExportSection">
                    <h3>匯出選項</h3>
                    <div class="export-buttons">
                        <button class="btn" id="lookupExportCsv">📄 匯出 CSV</button>
                    </div>
                </div>
            </div>
        </div>

        <!-- 批次修改介面 -->
        <div class="tab-content" id="updateContent">
            <div class="main-card">
                <!-- 第一階段：輸入短網址 -->
                <div class="update-stage-1" id="updateStage1">
                    <div class="form-section">
                        <div class="form-group">
                            <label for="updateApiKey">sv.link API Key</label>
                            <input type="password" id="updateApiKey" placeholder="請輸入您的 API Key">
                        </div>

                        <div class="form-group">
                            <label for="updateLinkList">要修改的短網址清單（每行一個）</label>
                            <div class="url-input-wrapper">
                                <div class="line-numbers" id="updateLineNumbers">1</div>
                                <textarea id="updateLinkList" placeholder="https://sv.link/xxxxx&#10;https://sv.link/yyyyy&#10;https://sv.link/zzzzz"></textarea>
                            </div>
                        </div>

                        <button class="btn" id="updateLookupBtn">
                            <div class="loading" id="updateLookupLoading"></div>
                            <span id="updateLookupBtnText">查詢當前目標</span>
                        </button>

                        <div class="progress" id="updateLookupProgress">
                            <div class="progress-bar" id="updateLookupProgressBar"></div>
                        </div>
                    </div>
                </div>

                <!-- 第二階段：三欄編輯 -->
                <div class="update-stage-2" id="updateStage2" style="display: none;">
                    <div class="form-section">
                        <h3>編輯目標網址</h3>
                        <div class="update-edit-container" id="updateEditContainer">
                            <!-- 動態生成三欄編輯界面 -->
                        </div>
                        
                        <div class="update-buttons">
                            <button class="btn btn-secondary" onclick="backToUpdateStage1()">← 重新輸入</button>
                            <button class="btn" id="updateConfirmBtn">確認修改</button>
                        </div>
                    </div>
                </div>

                <!-- 第三階段：二次確認 -->
                <div class="update-stage-3" id="updateStage3" style="display: none;">
                    <div class="form-section">
                        <h3>確認修改項目</h3>
                        <div class="update-confirm-list" id="updateConfirmList">
                            <!-- 動態生成確認清單 -->
                        </div>
                        
                        <div class="update-buttons">
                            <button class="btn btn-secondary" onclick="backToUpdateStage2()">← 返回編輯</button>
                            <button class="btn" id="updateExecuteBtn">
                                <div class="loading" id="updateExecuteLoading"></div>
                                <span id="updateExecuteBtnText">執行修改</span>
                            </button>
                        </div>

                        <div class="progress" id="updateExecuteProgress">
                            <div class="progress-bar" id="updateExecuteProgressBar"></div>
                        </div>
                    </div>
                </div>

                <!-- 第四階段：結果顯示 -->
                <div class="results" id="updateResults">
                    <div class="form-section">
                        <h3>修改結果</h3>
                        <div id="updateResultList"></div>
                    </div>
                </div>

                <div class="export-section" id="updateExportSection">
                    <h3>匯出選項</h3>
                    <div class="export-buttons">
                        <button class="btn" id="updateExportCsv">📄 匯出 CSV</button>
                        <button class="btn btn-secondary" onclick="resetUpdateFlow()">🔄 重新開始</button>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <footer class="footer">
        <p>© StreetVoice 街聲</p>
    </footer>

    <script src="/static/js/app.js"></script>
</body>
</html>